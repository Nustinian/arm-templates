{
    "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentParameters.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "workspaces_logs_analytics_01_name": {
            "defaultValue": "logs-analytics-01",
            "type": "string"
        }
    },
    "variables": {},
    "resources": [
        {
          "type": "Microsoft.Resources/deployments",
          "apiVersion": "2020-10-01",
          "name": "storageaccount-01",
          "properties": {
            "mode": "Incremental",
            "templateLink": {
              "uri": "https://raw.githubusercontent.com/Nustinian/arm-templates/main/children/logs-analytics-01/storageaccount-01-template.json?flush_cache=True"
            },
            "parametersLink": {
                "uri": "https://raw.githubusercontent.com/Nustinian/arm-templates/main/children/logs-analytics-01/storageaccount-01-parameters.json?flush_cache=True"
            }
          }
        },
        {
            "type": "microsoft.operationalinsights/workspaces",
            "apiVersion": "2020-10-01",
            "name": "[parameters('workspaces_logs_analytics_01_name')]",
            "location": "japaneast",
            "resources": [
                {
                    "apiVersion": "2020-08-01",
                    "type": "dataSources",
                    "name": "[concat(parameters('workspaces_logs_analytics_01_name'), 'sample')]",
                    "dependsOn": [
                        "[concat('Microsoft.OperationalInsights/workspaces/', '/', parameters('workspaces_logs_analytics_01_name'))]"
                    ],
                    "kind": "CustomLog",
                    "properties": {
                        "customLogName": "sample",
                        "description": "this is a description",
                        "inputs": [
                            {
                                "location": {
                                    "fileSystemLocations": {
                                        "windowsFileTypeLogPaths": [
                                            "C:\\MyApp\\Logs\\*.log"
                                        ]
                                    }
                                },
                                "recordDelimiter": {
                                    "regexDelimiter": {
                                        "pattern": "\\n",
                                        "matchIndex": 0,
                                        "numberdGroup": null
                                    }
                                }
                            }
                        ],
                        "extractions": [
                            {
                                "extractionName": "TimeGenerated",
                                "extractionType": "DateTime",
                                "extractionProperties": {
                                    "dateTimeExtraction": {
                                        "regex": null,
                                        "joinStringRegex": null
                                    }
                                }
                            }
                        ]
                    }
                },
                {
                    "type": "datasources",
                    "apiVersion": "2020-08-01",
                    "name": "WindowsEventsSystem",
                    "dependsOn": [
                        "[concat('Microsoft.OperationalInsights/workspaces/', parameters('workspaces_logs_analytics_01_name'))]"
                    ],
                    "kind": "WindowsEvent",
                    "properties": {
                        "eventLogName": "System",
                        "eventTypes": [
                            {
                                "eventType": "Error"
                            },
                            {
                                "eventType": "Warning"
                            }
                        ]
                    }
                },
                {
                    "type": "datasources",
                    "apiVersion": "2020-08-01",
                    "name": "WindowsEventsApplication",
                    "dependsOn": [
                        "[concat('Microsoft.OperationalInsights/workspaces/', parameters('workspaces_logs_analytics_01_name'))]"
                    ],
                    "kind": "WindowsEvent",
                    "properties": {
                        "eventLogName": "Application",
                        "eventTypes": [
                            {
                                "eventType": "Error"
                            },
                            {
                                "eventType": "Warning"
                            },
                            {
                                "eventType": "Information"
                            }
                        ]
                    }
                },
                {
                    "apiVersion": "2020-08-01",
                    "type": "datasources",
                    "name": "DataSource_WindowsPerformanceCounter_0a240e42-a7b0-47e2-a044-a20d678cb63e",
                    "dependsOn": [
                        "[concat('Microsoft.OperationalInsights/workspaces/', parameters('workspaces_logs_analytics_01_name'))]"
                    ],
                    "kind": "WindowsPerformanceCounter",
                    "properties": {
                        "objectName": "Network Adapter",
                        "instanceName": "*",
                        "intervalSeconds": 60,
                        "counterName": "Bytes Sent/sec"
                    }
                }
            ],
            "tags": {
                "from": "arm-template"
            },
            "properties": {
                "sku": {
                    "name": "pergb2018"
                },
                "retentionInDays": 30,
                "features": {
                    "enableLogAccessUsingOnlyResourcePermissions": true
                },
                "workspaceCapping": {
                    "dailyQuotaGb": 1
                },
                "publicNetworkAccessForIngestion": "Enabled",
                "publicNetworkAccessForQuery": "Enabled"
            }
        }
    ]
}